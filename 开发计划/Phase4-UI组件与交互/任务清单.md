# Phase 4: UI ç»„ä»¶ä¸äº¤äº’

**é˜¶æ®µç›®æ ‡**ï¼šå®ç°å®Œæ•´çš„ç”¨æˆ·ç•Œé¢å’Œäº¤äº’åŠŸèƒ½  
**é¢„è®¡å·¥æœŸ**ï¼š5å¤©  
**å¼€å‘æ¨¡å¼**ï¼šå¹¶è¡Œå¼€å‘ï¼ˆUI ç»„ä»¶å¯å¹¶è¡Œå¼€å‘ï¼‰

---

## ä»»åŠ¡æ¸…å•

### ä»»åŠ¡ 4.1ï¼šä¸»ç•Œé¢å¸ƒå±€ï¼ˆ1å¤©ï¼‰

#### 4.1.1 ä¸»å¸ƒå±€ç»„ä»¶

**æè¿°**ï¼šå®ç°åº”ç”¨çš„ä¸»å¸ƒå±€ç»“æ„

**æ–‡ä»¶**ï¼š`src/renderer/components/layout/MainLayout.vue`

```vue
<script setup lang="ts">
/**
 * MainLayout - ä¸»å¸ƒå±€ç»„ä»¶
 * 
 * å¸ƒå±€ç»“æ„ï¼š
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚              Header                  â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚         â”‚                           â”‚
 * â”‚ Sidebar â”‚       Content             â”‚
 * â”‚         â”‚                           â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚              Footer                  â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */
import { computed, ref } from 'vue';
import { Layout, Header, Content, Footer, Sider } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import ViewerHeader from './ViewerHeader.vue';
import ViewerSidebar from './ViewerSidebar.vue';
import ViewerContent from './ViewerContent.vue';
import ViewerFooter from './ViewerFooter.vue';

const viewerStore = useViewerStore();

const sidebarVisible = computed(() => viewerStore.sidebarVisible);
const sidebarWidth = computed(() => viewerStore.sidebarWidth);

const handleSidebarResize = (width: number) => {
  viewerStore.setSidebarWidth(width);
};
</script>

<template>
  <Layout class="viewer-layout">
    <!-- å¤´éƒ¨å¯¼èˆªæ  -->
    <Header class="viewer-layout__header">
      <ViewerHeader />
    </Header>
    
    <!-- ä¸»ä½“åŒºåŸŸ -->
    <Layout class="viewer-layout__body">
      <!-- ä¾§è¾¹æ  -->
      <Sider 
        v-if="sidebarVisible"
        :width="sidebarWidth"
        :collapsible="true"
        class="viewer-layout__sidebar"
        @resize="handleSidebarResize"
      >
        <ViewerSidebar />
      </Sider>
      
      <!-- å†…å®¹åŒº -->
      <Content class="viewer-layout__content">
        <ViewerContent />
      </Content>
    </Layout>
    
    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <Footer class="viewer-layout__footer">
      <ViewerFooter />
    </Footer>
  </Layout>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¸»å¸ƒå±€ç»„ä»¶å®ç°å®Œæˆ
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] ä¾§è¾¹æ å¯æŠ˜å å’Œè°ƒæ•´å®½åº¦

---

#### 4.1.2 ViewerContent å†…å®¹åŒºç»„ä»¶

**æè¿°**ï¼šå®ç°å†…å®¹åŒºç»„ä»¶ï¼Œæ˜¾ç¤ºå¡ç‰‡æˆ–ç®±å­å†…å®¹

**æ–‡ä»¶**ï¼š`src/renderer/components/layout/ViewerContent.vue`

```vue
<script setup lang="ts">
/**
 * ViewerContent - å†…å®¹åŒºç»„ä»¶
 */
import { computed, ref, watch, onMounted, onUnmounted } from 'vue';
import { useViewerStore } from '@renderer/store/viewer';
import { useViewerApp } from '@renderer/composables/useViewerApp';
import ContentEmpty from '../content/ContentEmpty.vue';
import ContentLoading from '../content/ContentLoading.vue';
import ContentError from '../content/ContentError.vue';

const viewerStore = useViewerStore();
const { viewerApp } = useViewerApp();

const contentRef = ref<HTMLElement | null>(null);

const currentContent = computed(() => viewerStore.currentContent);
const isLoading = computed(() => viewerStore.isLoading);
const error = computed(() => viewerStore.error);
const zoom = computed(() => viewerStore.viewOptions.zoom);

// ç›‘å¬ç¼©æ”¾å˜åŒ–
watch(zoom, (newZoom) => {
  if (contentRef.value) {
    contentRef.value.style.transform = `scale(${newZoom})`;
    contentRef.value.style.transformOrigin = 'top left';
  }
});

// å¤„ç†æ‹–æ‹½æ‰“å¼€æ–‡ä»¶
const handleDrop = async (event: DragEvent) => {
  event.preventDefault();
  const files = event.dataTransfer?.files;
  if (files && files.length > 0) {
    const file = files[0];
    if (file.name.endsWith('.card') || file.name.endsWith('.box')) {
      await viewerApp.navigate({
        type: file.name.endsWith('.card') ? 'card' : 'box',
        path: file.path,
      });
    }
  }
};

const handleDragOver = (event: DragEvent) => {
  event.preventDefault();
};
</script>

<template>
  <div 
    class="viewer-content"
    @drop="handleDrop"
    @dragover="handleDragOver"
  >
    <!-- åŠ è½½ä¸­ -->
    <ContentLoading v-if="isLoading" />
    
    <!-- é”™è¯¯çŠ¶æ€ -->
    <ContentError v-else-if="error" :error="error" />
    
    <!-- ç©ºçŠ¶æ€ -->
    <ContentEmpty v-else-if="currentContent.type === 'none'" />
    
    <!-- å†…å®¹æ¸²æŸ“åŒº -->
    <div 
      v-else
      ref="contentRef"
      class="viewer-content__render"
    >
      <!-- iframe ä¼šè¢«æŒ‚è½½åˆ°è¿™é‡Œ -->
    </div>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å†…å®¹åŒºç»„ä»¶å®ç°å®Œæˆ
- [ ] æ”¯æŒæ‹–æ‹½æ‰“å¼€æ–‡ä»¶
- [ ] ç¼©æ”¾åŠŸèƒ½æ­£å¸¸
- [ ] çŠ¶æ€æ˜¾ç¤ºæ­£ç¡®

---

### ä»»åŠ¡ 4.2ï¼šå¯¼èˆªæ ç»„ä»¶ï¼ˆ1å¤©ï¼‰

#### 4.2.1 ViewerHeader å¤´éƒ¨ç»„ä»¶

**æè¿°**ï¼šå®ç°å¤´éƒ¨å¯¼èˆªæ ç»„ä»¶

**æ–‡ä»¶**ï¼š`src/renderer/components/layout/ViewerHeader.vue`

```vue
<script setup lang="ts">
/**
 * ViewerHeader - å¤´éƒ¨å¯¼èˆªæ ç»„ä»¶
 */
import { computed } from 'vue';
import { Button, Space, Dropdown } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useViewerApp } from '@renderer/composables/useViewerApp';
import { useTranslation } from '@renderer/composables/useTranslation';
import NavigationButtons from '../navigation/NavigationButtons.vue';
import ZoomControls from '../toolbar/ZoomControls.vue';
import ThemeToggle from '../toolbar/ThemeToggle.vue';
import WindowControls from './WindowControls.vue';

const viewerStore = useViewerStore();
const { viewerApp } = useViewerApp();
const { t } = useTranslation();

const currentTitle = computed(() => {
  const content = viewerStore.currentContent;
  if (content.type === 'none') return t('viewer.title');
  return content.data?.metadata?.name ?? t('viewer.untitled');
});

const handleOpenFile = async () => {
  // æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
  if (window.electronAPI) {
    const result = await window.electronAPI.file.openDialog();
    if (result) {
      const type = result.endsWith('.card') ? 'card' : 'box';
      await viewerApp.navigate({ type, path: result });
    }
  }
};
</script>

<template>
  <div class="viewer-header">
    <!-- å·¦ä¾§ï¼šå¯¼èˆªæŒ‰é’®å’Œæ ‡é¢˜ -->
    <div class="viewer-header__left">
      <NavigationButtons />
      <span class="viewer-header__title">{{ currentTitle }}</span>
    </div>
    
    <!-- ä¸­é—´ï¼šæœç´¢å’Œå·¥å…· -->
    <div class="viewer-header__center">
      <ZoomControls />
    </div>
    
    <!-- å³ä¾§ï¼šä¸»é¢˜åˆ‡æ¢ã€èœå•ã€çª—å£æ§åˆ¶ -->
    <div class="viewer-header__right">
      <Space>
        <Button @click="handleOpenFile">
          {{ t('viewer.open') }}
        </Button>
        <ThemeToggle />
        <Dropdown placement="bottom-end">
          <Button>
            {{ t('viewer.menu') }}
          </Button>
          <template #content>
            <!-- èœå•å†…å®¹ -->
          </template>
        </Dropdown>
      </Space>
      
      <!-- çª—å£æ§åˆ¶æŒ‰é’®ï¼ˆä»…æ¡Œé¢ç«¯ï¼‰ -->
      <WindowControls v-if="window.electronAPI" />
    </div>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¤´éƒ¨ç»„ä»¶å®ç°å®Œæˆ
- [ ] å¯¼èˆªæŒ‰é’®æ­£å¸¸
- [ ] æ ‡é¢˜æ˜¾ç¤ºæ­£ç¡®
- [ ] èœå•åŠŸèƒ½æ­£å¸¸

---

#### 4.2.2 NavigationButtons å¯¼èˆªæŒ‰é’®ç»„ä»¶

**æè¿°**ï¼šå®ç°å‰è¿›/åé€€å¯¼èˆªæŒ‰é’®

**æ–‡ä»¶**ï¼š`src/renderer/components/navigation/NavigationButtons.vue`

```vue
<script setup lang="ts">
/**
 * NavigationButtons - å¯¼èˆªæŒ‰é’®ç»„ä»¶
 */
import { computed } from 'vue';
import { Button, Space, Tooltip } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useViewerApp } from '@renderer/composables/useViewerApp';
import { useTranslation } from '@renderer/composables/useTranslation';

const viewerStore = useViewerStore();
const { viewerApp } = useViewerApp();
const { t } = useTranslation();

const canGoBack = computed(() => viewerStore.canGoBack);
const canGoForward = computed(() => viewerStore.canGoForward);

const handleBack = () => {
  viewerApp.goBack();
};

const handleForward = () => {
  viewerApp.goForward();
};
</script>

<template>
  <Space class="navigation-buttons" :size="4">
    <Tooltip :content="t('navigation.back')">
      <Button 
        :disabled="!canGoBack"
        @click="handleBack"
      >
        â†
      </Button>
    </Tooltip>
    
    <Tooltip :content="t('navigation.forward')">
      <Button 
        :disabled="!canGoForward"
        @click="handleForward"
      >
        â†’
      </Button>
    </Tooltip>
  </Space>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¯¼èˆªæŒ‰é’®å®ç°å®Œæˆ
- [ ] ç¦ç”¨çŠ¶æ€æ­£ç¡®
- [ ] å¿«æ·é”®æ”¯æŒ

---

### ä»»åŠ¡ 4.3ï¼šä¾§è¾¹æ ç»„ä»¶ï¼ˆ1å¤©ï¼‰

#### 4.3.1 ViewerSidebar ä¾§è¾¹æ ç»„ä»¶

**æè¿°**ï¼šå®ç°ä¾§è¾¹æ ç»„ä»¶ï¼Œæ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯å’Œå¯¼èˆª

**æ–‡ä»¶**ï¼š`src/renderer/components/layout/ViewerSidebar.vue`

```vue
<script setup lang="ts">
/**
 * ViewerSidebar - ä¾§è¾¹æ ç»„ä»¶
 */
import { computed, ref } from 'vue';
import { Tabs, TabPane } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useTranslation } from '@renderer/composables/useTranslation';
import FileInfoPanel from '../sidebar/FileInfoPanel.vue';
import OutlinePanel from '../sidebar/OutlinePanel.vue';
import RecentFilesPanel from '../sidebar/RecentFilesPanel.vue';
import BookmarksPanel from '../sidebar/BookmarksPanel.vue';

const { t } = useTranslation();
const viewerStore = useViewerStore();

const activeTab = ref('info');
const currentContent = computed(() => viewerStore.currentContent);
const hasContent = computed(() => currentContent.value.type !== 'none');
</script>

<template>
  <div class="viewer-sidebar">
    <Tabs v-model="activeTab" type="card">
      <!-- æ–‡ä»¶ä¿¡æ¯ -->
      <TabPane name="info" :tab="t('sidebar.info')">
        <FileInfoPanel v-if="hasContent" :content="currentContent" />
        <div v-else class="viewer-sidebar__empty">
          {{ t('sidebar.noFile') }}
        </div>
      </TabPane>
      
      <!-- å¤§çº² -->
      <TabPane name="outline" :tab="t('sidebar.outline')">
        <OutlinePanel v-if="hasContent" :content="currentContent" />
        <div v-else class="viewer-sidebar__empty">
          {{ t('sidebar.noOutline') }}
        </div>
      </TabPane>
      
      <!-- æœ€è¿‘æ–‡ä»¶ -->
      <TabPane name="recent" :tab="t('sidebar.recent')">
        <RecentFilesPanel />
      </TabPane>
      
      <!-- ä¹¦ç­¾ -->
      <TabPane name="bookmarks" :tab="t('sidebar.bookmarks')">
        <BookmarksPanel />
      </TabPane>
    </Tabs>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¾§è¾¹æ ç»„ä»¶å®ç°å®Œæˆ
- [ ] å¤šæ ‡ç­¾åˆ‡æ¢æ­£å¸¸
- [ ] æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®

---

#### 4.3.2 FileInfoPanel æ–‡ä»¶ä¿¡æ¯é¢æ¿

**æè¿°**ï¼šæ˜¾ç¤ºå½“å‰æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯

**æ–‡ä»¶**ï¼š`src/renderer/components/sidebar/FileInfoPanel.vue`

```vue
<script setup lang="ts">
/**
 * FileInfoPanel - æ–‡ä»¶ä¿¡æ¯é¢æ¿
 */
import { computed } from 'vue';
import { Card, Tag, Space, Text } from '@chips/components';
import { useTranslation } from '@renderer/composables/useTranslation';
import type { CurrentContent } from '@common/types';

const props = defineProps<{
  content: CurrentContent;
}>();

const { t } = useTranslation();

const metadata = computed(() => props.content.data?.metadata);
const isCard = computed(() => props.content.type === 'card');

const formattedDate = (dateStr: string) => {
  return new Date(dateStr).toLocaleString();
};
</script>

<template>
  <div class="file-info-panel">
    <Card v-if="metadata">
      <!-- åç§° -->
      <div class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.name') }}</Text>
        <Text>{{ metadata.name }}</Text>
      </div>
      
      <!-- ç±»å‹ -->
      <div class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.type') }}</Text>
        <Text>{{ isCard ? t('fileInfo.card') : t('fileInfo.box') }}</Text>
      </div>
      
      <!-- åˆ›å»ºæ—¶é—´ -->
      <div class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.createdAt') }}</Text>
        <Text>{{ formattedDate(metadata.created_at) }}</Text>
      </div>
      
      <!-- ä¿®æ”¹æ—¶é—´ -->
      <div class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.modifiedAt') }}</Text>
        <Text>{{ formattedDate(metadata.modified_at) }}</Text>
      </div>
      
      <!-- æ ‡ç­¾ -->
      <div v-if="metadata.tags?.length" class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.tags') }}</Text>
        <Space :size="4" wrap>
          <Tag v-for="tag in metadata.tags" :key="String(tag)">
            {{ Array.isArray(tag) ? tag.join(':') : tag }}
          </Tag>
        </Space>
      </div>
      
      <!-- æè¿° -->
      <div v-if="metadata.description" class="file-info-panel__item">
        <Text type="secondary">{{ t('fileInfo.description') }}</Text>
        <Text>{{ metadata.description }}</Text>
      </div>
    </Card>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ–‡ä»¶ä¿¡æ¯é¢æ¿å®ç°å®Œæˆ
- [ ] ä¿¡æ¯æ˜¾ç¤ºå®Œæ•´
- [ ] æ ¼å¼åŒ–æ­£ç¡®

---

### ä»»åŠ¡ 4.4ï¼šå·¥å…·æ ç»„ä»¶ï¼ˆ1å¤©ï¼‰

#### 4.4.1 ZoomControls ç¼©æ”¾æ§åˆ¶ç»„ä»¶

**æè¿°**ï¼šå®ç°ç¼©æ”¾æ§åˆ¶ç»„ä»¶

**æ–‡ä»¶**ï¼š`src/renderer/components/toolbar/ZoomControls.vue`

```vue
<script setup lang="ts">
/**
 * ZoomControls - ç¼©æ”¾æ§åˆ¶ç»„ä»¶
 */
import { computed } from 'vue';
import { Button, Space, Select, Tooltip } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useTranslation } from '@renderer/composables/useTranslation';

const viewerStore = useViewerStore();
const { t } = useTranslation();

const zoom = computed(() => viewerStore.viewOptions.zoom);
const zoomPercent = computed(() => Math.round(zoom.value * 100));

const presetZooms = [
  { value: 0.5, label: '50%' },
  { value: 0.75, label: '75%' },
  { value: 1, label: '100%' },
  { value: 1.25, label: '125%' },
  { value: 1.5, label: '150%' },
  { value: 2, label: '200%' },
];

const handleZoomIn = () => {
  viewerStore.setZoom(zoom.value + 0.1);
};

const handleZoomOut = () => {
  viewerStore.setZoom(zoom.value - 0.1);
};

const handleZoomReset = () => {
  viewerStore.setZoom(1);
};

const handleZoomChange = (value: number) => {
  viewerStore.setZoom(value);
};
</script>

<template>
  <div class="zoom-controls">
    <Space :size="4">
      <Tooltip :content="t('zoom.out')">
        <Button 
          size="small" 
          :disabled="zoom <= 0.1"
          @click="handleZoomOut"
        >
          âˆ’
        </Button>
      </Tooltip>
      
      <Select
        :value="zoom"
        :options="presetZooms"
        size="small"
        style="width: 80px"
        @change="handleZoomChange"
      >
        <template #selected>
          {{ zoomPercent }}%
        </template>
      </Select>
      
      <Tooltip :content="t('zoom.in')">
        <Button 
          size="small"
          :disabled="zoom >= 5"
          @click="handleZoomIn"
        >
          +
        </Button>
      </Tooltip>
      
      <Tooltip :content="t('zoom.reset')">
        <Button 
          size="small"
          @click="handleZoomReset"
        >
          â†º
        </Button>
      </Tooltip>
    </Space>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ç¼©æ”¾æ§åˆ¶ç»„ä»¶å®ç°å®Œæˆ
- [ ] ç¼©æ”¾åŠŸèƒ½æ­£å¸¸
- [ ] é¢„è®¾ç¼©æ”¾å€¼å¯é€‰

---

#### 4.4.2 ThemeToggle ä¸»é¢˜åˆ‡æ¢ç»„ä»¶

**æè¿°**ï¼šå®ç°ä¸»é¢˜åˆ‡æ¢ç»„ä»¶

**æ–‡ä»¶**ï¼š`src/renderer/components/toolbar/ThemeToggle.vue`

```vue
<script setup lang="ts">
/**
 * ThemeToggle - ä¸»é¢˜åˆ‡æ¢ç»„ä»¶
 */
import { computed } from 'vue';
import { Button, Dropdown, Tooltip } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useTranslation } from '@renderer/composables/useTranslation';
import type { ThemeType } from '@common/types';

const viewerStore = useViewerStore();
const { t } = useTranslation();

const currentTheme = computed(() => viewerStore.currentTheme);

const themeOptions: Array<{ value: ThemeType; label: string; icon: string }> = [
  { value: 'light', label: t('theme.light'), icon: 'â˜€ï¸' },
  { value: 'dark', label: t('theme.dark'), icon: 'ğŸŒ™' },
  { value: 'system', label: t('theme.system'), icon: 'ğŸ’»' },
];

const currentThemeOption = computed(() => 
  themeOptions.find(opt => opt.value === currentTheme.value)
);

const handleThemeChange = (theme: ThemeType) => {
  viewerStore.setTheme(theme);
};
</script>

<template>
  <Dropdown placement="bottom-end">
    <Tooltip :content="t('theme.toggle')">
      <Button size="small">
        {{ currentThemeOption?.icon }}
      </Button>
    </Tooltip>
    
    <template #content>
      <div class="theme-toggle__menu">
        <Button
          v-for="option in themeOptions"
          :key="option.value"
          :type="currentTheme === option.value ? 'primary' : 'default'"
          block
          @click="handleThemeChange(option.value)"
        >
          {{ option.icon }} {{ option.label }}
        </Button>
      </div>
    </template>
  </Dropdown>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ä¸»é¢˜åˆ‡æ¢ç»„ä»¶å®ç°å®Œæˆ
- [ ] ä¸‰ç§ä¸»é¢˜åˆ‡æ¢æ­£å¸¸
- [ ] ç³»ç»Ÿä¸»é¢˜è·Ÿéšæ­£å¸¸

---

### ä»»åŠ¡ 4.5ï¼šå¿«æ·é”®ç³»ç»Ÿï¼ˆ0.5å¤©ï¼‰

#### 4.5.1 ShortcutManager å¿«æ·é”®ç®¡ç†å™¨

**æè¿°**ï¼šå®ç°å¿«æ·é”®ç®¡ç†ç³»ç»Ÿ

**æ–‡ä»¶**ï¼š`src/renderer/core/shortcuts/ShortcutManager.ts`

```typescript
/**
 * ShortcutManager - å¿«æ·é”®ç®¡ç†å™¨
 */
import type { ShortcutBinding } from '@common/types';
import { DEFAULT_SHORTCUTS } from '@common/constants';
import { logger } from '@renderer/services';

type ShortcutHandler = () => void | Promise<void>;

export class ShortcutManager {
  private bindings: Map<string, ShortcutBinding> = new Map();
  private handlers: Map<string, ShortcutHandler> = new Map();
  private enabled = true;
  private log = logger.createChild('ShortcutManager');
  
  constructor() {
    this.setupDefaultBindings();
    this.setupKeyListener();
  }
  
  /**
   * æ³¨å†Œå¿«æ·é”®å¤„ç†å™¨
   */
  register(action: string, handler: ShortcutHandler): void {
    this.handlers.set(action, handler);
    this.log.debug(`Registered handler for action: ${action}`);
  }
  
  /**
   * æ³¨é”€å¿«æ·é”®å¤„ç†å™¨
   */
  unregister(action: string): void {
    this.handlers.delete(action);
  }
  
  /**
   * è®¾ç½®å¿«æ·é”®ç»‘å®š
   */
  setBinding(action: string, binding: Omit<ShortcutBinding, 'action'>): void {
    this.bindings.set(action, { ...binding, action });
  }
  
  /**
   * è·å–å¿«æ·é”®ç»‘å®š
   */
  getBinding(action: string): ShortcutBinding | undefined {
    return this.bindings.get(action);
  }
  
  /**
   * è·å–æ‰€æœ‰ç»‘å®š
   */
  getAllBindings(): ShortcutBinding[] {
    return Array.from(this.bindings.values());
  }
  
  /**
   * é‡ç½®ä¸ºé»˜è®¤ç»‘å®š
   */
  resetToDefaults(): void {
    this.bindings.clear();
    this.setupDefaultBindings();
  }
  
  /**
   * å¯ç”¨å¿«æ·é”®
   */
  enable(): void {
    this.enabled = true;
  }
  
  /**
   * ç¦ç”¨å¿«æ·é”®
   */
  disable(): void {
    this.enabled = false;
  }
  
  /**
   * é”€æ¯
   */
  destroy(): void {
    document.removeEventListener('keydown', this.handleKeyDown);
    this.handlers.clear();
    this.bindings.clear();
  }
  
  private setupDefaultBindings(): void {
    for (const [action, binding] of Object.entries(DEFAULT_SHORTCUTS)) {
      this.bindings.set(action, {
        ...binding,
        action,
      });
    }
  }
  
  private setupKeyListener(): void {
    document.addEventListener('keydown', this.handleKeyDown.bind(this));
  }
  
  private handleKeyDown = (event: KeyboardEvent): void => {
    if (!this.enabled) return;
    
    // å¿½ç•¥è¾“å…¥æ¡†ä¸­çš„å¿«æ·é”®
    if (this.isInputElement(event.target as HTMLElement)) return;
    
    for (const [action, binding] of this.bindings) {
      if (this.matchesBinding(event, binding)) {
        event.preventDefault();
        const handler = this.handlers.get(action);
        if (handler) {
          this.log.debug(`Executing shortcut: ${action}`);
          handler();
        }
        return;
      }
    }
  };
  
  private matchesBinding(event: KeyboardEvent, binding: ShortcutBinding): boolean {
    if (event.key.toLowerCase() !== binding.key.toLowerCase()) return false;
    
    const modifiers = binding.modifiers ?? [];
    
    if (modifiers.includes('ctrl') !== event.ctrlKey) return false;
    if (modifiers.includes('alt') !== event.altKey) return false;
    if (modifiers.includes('shift') !== event.shiftKey) return false;
    if (modifiers.includes('meta') !== event.metaKey) return false;
    
    return true;
  }
  
  private isInputElement(element: HTMLElement): boolean {
    const tagName = element.tagName.toLowerCase();
    return tagName === 'input' || tagName === 'textarea' || element.isContentEditable;
  }
}

// å•ä¾‹å¯¼å‡º
export const shortcutManager = new ShortcutManager();
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å¿«æ·é”®ç®¡ç†å™¨å®ç°å®Œæˆ
- [ ] é»˜è®¤å¿«æ·é”®é…ç½®æ­£ç¡®
- [ ] å¿«æ·é”®è§¦å‘æ­£å¸¸
- [ ] è¾“å…¥æ¡†ä¸­æ­£ç¡®å¿½ç•¥

---

#### 4.5.2 å¿«æ·é”®ç»‘å®šè®¾ç½®

**æè¿°**ï¼šåœ¨ ViewerApp ä¸­ç»‘å®šå¿«æ·é”®å¤„ç†å™¨

**æ–‡ä»¶**ï¼š`src/renderer/core/viewer/setupShortcuts.ts`

```typescript
/**
 * è®¾ç½®å¿«æ·é”®ç»‘å®š
 */
import { shortcutManager } from '../shortcuts/ShortcutManager';
import type { ViewerApp } from './ViewerApp';
import type { IViewerStore } from '@renderer/store/viewer';

export function setupShortcuts(
  viewerApp: ViewerApp, 
  viewerStore: ReturnType<typeof useViewerStore>
): void {
  // æ‰“å¼€æ–‡ä»¶
  shortcutManager.register('open-file', async () => {
    if (window.electronAPI) {
      const result = await window.electronAPI.file.openDialog();
      if (result) {
        await viewerApp.navigate({
          type: result.endsWith('.card') ? 'card' : 'box',
          path: result,
        });
      }
    }
  });
  
  // å…³é—­æ–‡ä»¶
  shortcutManager.register('close-file', () => {
    viewerApp.closeContent();
  });
  
  // ç¼©æ”¾
  shortcutManager.register('zoom-in', () => {
    viewerStore.setZoom(viewerStore.viewOptions.zoom + 0.1);
  });
  
  shortcutManager.register('zoom-out', () => {
    viewerStore.setZoom(viewerStore.viewOptions.zoom - 0.1);
  });
  
  shortcutManager.register('zoom-reset', () => {
    viewerStore.setZoom(1);
  });
  
  // å…¨å±
  shortcutManager.register('fullscreen', () => {
    if (window.electronAPI) {
      window.electronAPI.window.fullscreen();
    } else {
      document.documentElement.requestFullscreen();
    }
  });
  
  // å¯¼èˆª
  shortcutManager.register('navigate-back', () => {
    viewerApp.goBack();
  });
  
  shortcutManager.register('navigate-forward', () => {
    viewerApp.goForward();
  });
  
  // ä¾§è¾¹æ 
  shortcutManager.register('toggle-sidebar', () => {
    viewerStore.toggleSidebar();
  });
  
  // ä¸»é¢˜
  shortcutManager.register('toggle-theme', () => {
    const themes = ['light', 'dark', 'system'];
    const currentIndex = themes.indexOf(viewerStore.currentTheme);
    const nextIndex = (currentIndex + 1) % themes.length;
    viewerStore.setTheme(themes[nextIndex]);
  });
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰é»˜è®¤å¿«æ·é”®ç»‘å®šå®Œæˆ
- [ ] å¿«æ·é”®åŠŸèƒ½æ­£å¸¸

---

### ä»»åŠ¡ 4.6ï¼šçŠ¶æ€æ ç»„ä»¶ï¼ˆ0.5å¤©ï¼‰

#### 4.6.1 ViewerFooter çŠ¶æ€æ ç»„ä»¶

**æè¿°**ï¼šå®ç°åº•éƒ¨çŠ¶æ€æ ç»„ä»¶

**æ–‡ä»¶**ï¼š`src/renderer/components/layout/ViewerFooter.vue`

```vue
<script setup lang="ts">
/**
 * ViewerFooter - åº•éƒ¨çŠ¶æ€æ ç»„ä»¶
 */
import { computed } from 'vue';
import { Space, Text } from '@chips/components';
import { useViewerStore } from '@renderer/store/viewer';
import { useTranslation } from '@renderer/composables/useTranslation';

const viewerStore = useViewerStore();
const { t } = useTranslation();

const currentContent = computed(() => viewerStore.currentContent);
const zoom = computed(() => viewerStore.viewOptions.zoom);
const zoomPercent = computed(() => Math.round(zoom.value * 100));

const statusText = computed(() => {
  if (viewerStore.isLoading) {
    return viewerStore.loadingMessage || t('status.loading');
  }
  if (viewerStore.error) {
    return viewerStore.error;
  }
  if (currentContent.value.type === 'none') {
    return t('status.ready');
  }
  return t('status.viewing');
});

const contentInfo = computed(() => {
  if (currentContent.value.type === 'none') return '';
  
  const metadata = currentContent.value.data?.metadata;
  if (!metadata) return '';
  
  return currentContent.value.path ?? '';
});
</script>

<template>
  <div class="viewer-footer">
    <!-- å·¦ä¾§ï¼šçŠ¶æ€ä¿¡æ¯ -->
    <div class="viewer-footer__left">
      <Text type="secondary" size="small">
        {{ statusText }}
      </Text>
    </div>
    
    <!-- ä¸­é—´ï¼šæ–‡ä»¶è·¯å¾„ -->
    <div class="viewer-footer__center">
      <Text v-if="contentInfo" type="secondary" size="small">
        {{ contentInfo }}
      </Text>
    </div>
    
    <!-- å³ä¾§ï¼šç¼©æ”¾æ¯”ä¾‹ -->
    <div class="viewer-footer__right">
      <Text type="secondary" size="small">
        {{ zoomPercent }}%
      </Text>
    </div>
  </div>
</template>
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] çŠ¶æ€æ ç»„ä»¶å®ç°å®Œæˆ
- [ ] çŠ¶æ€ä¿¡æ¯æ˜¾ç¤ºæ­£ç¡®
- [ ] æ–‡ä»¶è·¯å¾„æ˜¾ç¤ºæ­£ç¡®

---

## é˜¶æ®µå®Œæˆæ ‡å‡†

### å¿…é¡»å®Œæˆé¡¹

- [ ] ä¸»å¸ƒå±€ç»„ä»¶å®Œæˆ
- [ ] å¤´éƒ¨å¯¼èˆªæ å®Œæˆ
- [ ] ä¾§è¾¹æ ç»„ä»¶å®Œæˆ
- [ ] å·¥å…·æ ç»„ä»¶å®Œæˆ
- [ ] å¿«æ·é”®ç³»ç»Ÿå®Œæˆ
- [ ] çŠ¶æ€æ ç»„ä»¶å®Œæˆ
- [ ] å®Œæ•´çš„ç”¨æˆ·ç•Œé¢å¯ç”¨

### è´¨é‡è¦æ±‚

- [ ] ç»„ä»¶æ— æ ·å¼ï¼ˆç¬¦åˆæ— æ ·å¼ç»„ä»¶åº“è§„èŒƒï¼‰
- [ ] æ‰€æœ‰æ–‡æœ¬ä½¿ç”¨å¤šè¯­è¨€
- [ ] å“åº”å¼å¸ƒå±€æ­£å¸¸
- [ ] ç»„ä»¶æµ‹è¯•é€šè¿‡

### æäº¤è®°å½•

å®Œæˆååº”æœ‰ä»¥ä¸‹ Git æäº¤ï¼š
1. `feat: å®ç°ä¸»å¸ƒå±€ç»„ä»¶`
2. `feat: å®ç°å¤´éƒ¨å¯¼èˆªæ `
3. `feat: å®ç°ä¾§è¾¹æ ç»„ä»¶`
4. `feat: å®ç°å·¥å…·æ ç»„ä»¶`
5. `feat: å®ç°å¿«æ·é”®ç³»ç»Ÿ`
6. `feat: å®ç°çŠ¶æ€æ ç»„ä»¶`

---

**ä¸‹ä¸€é˜¶æ®µ**ï¼šPhase 5 - æµ‹è¯•ä¸ä¼˜åŒ–
