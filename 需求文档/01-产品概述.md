# Chips Viewer - 产品概述

**版本**: 2.0.0  
**更新时间**: 2026-01-31  
**状态**: 正式版

---

## 1. 产品定位

### 1.1 核心定义

Chips Viewer（卡片查看器）是 Chips 生态系统中专门用于**查看和浏览卡片及箱子内容**的轻量级软件产品。它基于薯片内核（Chips Core）和公共基础层（Chips Foundation）构建，提供高度插件化的内容查看能力。

### 1.2 设计理念

Chips Viewer 遵循以下核心设计理念：

**插件化优先**：
- 所有查看工具都是插件（视频播放器、音频播放器、图片查看器、代码查看器等）
- 系统提供默认的基础查看工具插件
- 用户可以安装第三方专业查看工具插件
- 插件支持热插拔，无需重启应用

**轻量高效**：
- 文件体积小巧（约 50-100MB）
- 启动速度快（< 2 秒）
- 资源占用低（空闲 < 200MB）
- 专注于查看功能，不包含编辑能力

**基于生态基础设施**：
- 共享薯片内核的路由系统
- 调用公共基础层的所有查看工具
- 使用统一的组件库构建界面
- 遵循生态的标准和规范

### 1.3 与编辑引擎的关系

Chips 生态采用**双轨设计**，满足不同用户需求：

**方案一：独立查看器产品**
- 单独的可执行文件，体积小巧
- 快速启动，适合日常快速浏览
- 只包含查看相关的核心功能
- 适合只需要查看内容的用户
- 可作为操作系统默认的 `.card` 文件关联程序

**方案二：编辑引擎的查看模式**
- 编辑引擎内置完整的查看功能
- 通过"锁定"按钮切换到查看模式
- 查看模式下禁用所有编辑功能
- 适合需要频繁在查看和编辑间切换的用户
- 共享编辑引擎的所有插件和配置

**设计决策**：
- 优先开发独立查看器产品（轻量级用户优先）
- 编辑引擎可以复用查看器的核心模块
- 两者共享插件生态和基础设施
- 保持接口一致性，确保用户体验统一

---

## 2. 架构定位

### 2.1 在生态中的位置

```
生态层级结构：
┌─────────────────────────────────────┐
│         软件产品层                    │
│   ┌──────────┐      ┌──────────┐   │
│   │ 编辑引擎  │      │ 查看器    │   │
│   └──────────┘      └──────────┘   │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│         功能插件层                    │
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌────┐ │
│  │卡片 │  │布局 │  │查看 │  │主题│ │
│  │插件 │  │插件 │  │工具 │  │包  │ │
│  └─────┘  └─────┘  └─────┘  └────┘ │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│      公共基础层（Foundation）          │
│  媒体 | 文本 | 文件 | 网络 | 界面    │
└─────────────────────────────────────┘
              ↓
┌─────────────────────────────────────┐
│      薯片内核（Chips Core）            │
│  路由 | 插件 | 资源 | 配置 | 事件    │
└─────────────────────────────────────┘
```

### 2.2 依赖关系

**核心依赖**：
- **薯片内核（Chips Core）**：提供路由、插件管理、文件解析、事件系统
- **公共基础层（Chips Foundation）**：提供所有查看工具和通用模块
- **组件库（Chips ComponentLibrary）**：提供界面组件（无样式）
- **主题系统**：提供视觉样式

**通信方式**：
- **所有模块间通信通过微内核路由**（严格遵循中心路由原则）
- 查看器不直接调用基础层模块，而是通过内核路由请求
- 插件通过标准接口与查看器通信
- 前后端完全分离，通过路由通信

### 2.3 模块化设计

Chips Viewer 采用极致的模块化设计：

```
查看器模块结构：
├── 核心模块（Core Module）
│   ├── 应用启动和初始化
│   ├── 窗口管理
│   └── 生命周期管理
│
├── 渲染调度模块（Rendering Dispatcher）
│   ├── 调用 CardRenderer（公共基础层）
│   ├── 调用 BoxRenderer（公共基础层）
│   ├── 调用 ThemeEngine（公共基础层）
│   └── 布局管理和组织
│
├── 插件系统（Plugin System）
│   ├── 插件管理器
│   ├── 插件加载器
│   ├── 插件调度器
│   └── 默认查看工具插件集
│
├── 用户界面（UI Module）
│   ├── 工具栏
│   ├── 侧边栏
│   ├── 内容区域
│   └── 状态栏
│
└── 服务模块（Service Module）
    ├── 导航服务
    ├── 搜索服务
    ├── 缓存服务
    └── 配置服务
```

**重要说明**：
- **卡片渲染逻辑在公共基础层**（CardRenderer、BaseCardRenderers、BoxRenderer、ThemeEngine）
- **查看器通过路由调用这些模块**，不自己实现渲染逻辑
- 查看器负责调度、组织和用户交互，不负责具体的渲染实现

每个模块：
- 独立开发和维护
- 通过标准接口对外提供服务
- 只通过微内核路由与其他模块通信
- 可以随时被替换和升级

---

## 3. 核心特性

### 3.1 插件化查看工具系统

**设计原则**：
- 查看器内部包含各种文件查看工具
- 这些查看工具都是插件
- 系统默认提供基础查看工具插件
- 用户可以安装更强大的专业查看工具插件

**默认查看工具插件**：

| 工具类型 | 基于组件 | 支持格式 | 核心功能 |
|---------|---------|---------|---------|
| 视频播放器 | Video.js | MP4, WebM, MOV, AVI, MKV | 播放控制、字幕、进度记忆、速度调节 |
| 音频播放器 | Howler.js | MP3, WAV, FLAC, AAC, OGG | 播放控制、歌词、可视化、播放列表 |
| 图片查看器 | Viewer.js | JPEG, PNG, GIF, WebP, SVG | 缩放、旋转、幻灯片、多图浏览 |
| 代码查看器 | Prism.js | 100+ 编程语言 | 语法高亮、行号、代码折叠、搜索 |
| Markdown 渲染器 | Marked.js + KaTeX | Markdown, GFM | 渲染、公式、代码高亮、目录 |
| PDF 查看器 | PDF.js | PDF | 页面导航、缩放、搜索、目录 |
| 文本查看器 | 原生实现 | TXT, LOG | 纯文本显示、搜索、换行 |
| 3D 模型渲染器 | Three.js | OBJ, FBX, GLTF | 3D 显示、旋转、缩放、材质 |

**这些查看工具都来自公共基础层（Chips Foundation）**：
- 查看器不需要自己实现这些工具
- 通过微内核路由调用基础层提供的组件
- 所有 Chips 生态软件共享同一套查看工具
- 工具的更新和维护在基础层统一进行

**第三方专业查看工具示例**：
- 专业视频播放器（支持更多格式、高级控制、视频效果）
- 音乐发烧友播放器（高保真输出、均衡器、高级可视化）
- 程序员代码查看器（更多语言、智能提示、符号跳转）
- 专业图片查看器（图片编辑、滤镜、批量处理）

**插件替换机制**：
- 用户可以安装多个支持相同格式的查看工具插件
- 在设置中为每种格式设置默认查看工具
- 查看时可以临时切换使用不同的查看工具
- 插件支持热插拔，无需重启应用

### 3.2 完整的卡片和箱子查看能力

**卡片查看**：
- 支持所有基础卡片类型的渲染
- 支持复合卡片的嵌套展示
- 自动选择合适的查看工具
- 显示卡片元数据和层级结构

**箱子查看**：
- 支持多种箱子布局（网格、瀑布流、列表、看板等）
- 展示箱子中的卡片集合
- 提供筛选、搜索、排序功能
- 支持大量卡片的虚拟滚动

**内容识别**：
- 内核识别卡片包含的文件类型
- 自动查找支持该格式的查看工具插件
- 使用用户设置的默认查看工具
- 如果没有设置，使用系统默认工具

**工作流程**：
```
用户打开卡片
    ↓
内核解析卡片文件
    ↓
识别卡片包含的内容类型（如视频文件）
    ↓
查看器通过路由请求内核：查找视频播放器插件
    ↓
内核返回可用的播放器插件列表
    ↓
查看器选择用户设置的默认播放器
    ↓
通过路由调用插件的渲染接口
    ↓
插件通过路由请求基础层的视频播放器组件
    ↓
基础层创建播放器界面并返回
    ↓
插件将播放器显示在查看器中
    ↓
用户看到视频并可以播放
```

### 3.3 主题系统支持

**原子级主题应用**：
- 每个卡片可以单独设置主题
- 每个界面组件可以单独设置主题
- 支持主题的层级覆盖（全局→应用→卡片→组件）

**主题包管理**：
- 内置多个官方主题包
- 支持安装第三方主题包
- 主题包是独立的插件
- 可以实时切换主题

**功能与样式分离**：
- 组件只实现功能逻辑
- 所有视觉效果由主题包提供
- 同一功能可以呈现完全不同的视觉效果

### 3.4 跨平台支持

**桌面端**：
- Windows 10+
- macOS 10.13+
- Linux（主流发行版）

**移动端**（未来支持）：
- iOS 13+
- Android 8.0+
- 触控交互优化

**Web 端**（未来支持）：
- 现代浏览器
- 无需安装
- 完整功能

---

## 4. 技术优势

### 4.1 基于公共基础层

**优势**：
- **零重复开发**：所有查看工具由基础层提供，查看器直接使用
- **统一维护**：工具的更新、修复在基础层统一进行
- **共享生态**：所有 Chips 软件共享同一套查看工具
- **质量保证**：基础层的组件经过充分测试和优化

**调用方式**：
```typescript
// 查看器通过微内核路由调用基础层组件
const response = await Core.request({
  service: 'foundation.video_player.create',
  payload: {
    video_uri: 'chips://card/abc123/video.mp4',
    options: {
      controls: true,
      autoplay: false
    }
  }
});

// 基础层返回播放器实例
const player = response.data.player;
```

**不是直接调用**：
```typescript
// ❌ 错误：查看器不直接调用基础层
import { VideoPlayer } from '@chips/foundation';
const player = new VideoPlayer();

// ✅ 正确：通过微内核路由
const player = await Core.request({
  service: 'foundation.video_player.create',
  // ...
});
```

### 4.2 微内核路由架构

**核心原则**：
- **所有模块间通信都通过微内核路由**
- 模块之间不能直接调用
- 内核负责请求的路由、验证和转发

**优势**：
- **完全解耦**：模块之间互不依赖
- **可替换性**：任何模块都可以被替换
- **权限控制**：内核统一验证权限
- **易于调试**：所有通信都可以记录和监控

**应用示例**：
```typescript
// 查看器请求打开卡片
await Core.request({
  service: 'card.open',
  payload: { card_id: 'abc123' }
});

// 查看器请求获取资源
const resource = await Core.request({
  service: 'resource.fetch',
  payload: { uri: 'chips://card/abc123/image.jpg' }
});

// 查看器请求应用主题
await Core.request({
  service: 'theme.apply',
  payload: { theme_id: 'dark', target: 'card_abc123' }
});
```

### 4.3 插件生态

**开放的生态系统**：
- 任何开发者都可以开发查看工具插件
- 插件发布到应用市场，用户可以搜索和安装
- 插件可以是免费的，也可以是商业产品
- 形成多样化的查看工具生态

**插件标准**：
- 所有插件遵循统一的接口规范
- 插件通过 manifest 声明能力和需求
- 插件在沙箱中运行，保证安全性
- 插件可以声明依赖其他插件

**插件类型**：
- 查看工具插件（本文档重点）
- 主题包插件
- 布局插件（用于箱子展示）
- 功能扩展插件

---

## 5. 核心价值

### 5.1 对用户的价值

**轻量便捷**：
- 快速启动，随时查看
- 低资源占用，不影响其他工作
- 简洁界面，专注内容
- 适合日常浏览和快速预览

**专业体验**：
- 高质量的内容渲染
- 专业的查看工具（基于成熟开源组件）
- 流畅的交互动画
- 精美的主题和视觉效果

**可扩展性**：
- 通过插件支持更多格式
- 安装专业查看工具满足特殊需求
- 自定义主题和界面
- 集成到工作流程

### 5.2 对生态的价值

**降低使用门槛**：
- 非创作者也能轻松查看卡片
- 扩大 Chips 内容的受众范围
- 促进卡片内容的分享和传播

**专业化分工**：
- 查看和编辑功能分离
- 各自专注于核心能力
- 提供更好的专业体验

**生态完整性**：
- 补充生态中的查看环节
- 与编辑器、SDK 形成完整闭环
- 支持更多应用场景

---

## 6. 目标用户

### 6.1 主要用户群体

**内容消费者**：
- 只需要查看卡片内容，不需要编辑
- 希望软件启动快、占用资源少
- 典型场景：查看他人分享的卡片、浏览卡片库

**移动端用户**：
- 在手机或平板上查看卡片
- 需要流畅的触控交互体验
- 存储空间有限，不想安装完整编辑器

**企业用户**：
- 使用卡片作为文档/知识库查看
- 需要统一的内容查看标准
- 可能需要限制编辑权限

**开发者**：
- 集成 Chips 查看能力到自己的应用中
- 需要稳定的查看 API
- 希望自定义查看界面和交互

### 6.2 用户需求

**快速访问**：
- 双击 `.card` 文件即可打开查看
- 启动速度 < 2 秒
- 文件打开速度 < 500ms

**流畅体验**：
- 快速渲染
- 流畅滚动（60fps）
- 响应迅速（< 100ms）

**格式支持**：
- 支持所有基础卡片类型
- 支持常见媒体格式
- 通过插件扩展更多格式

**专业工具**：
- 高质量的播放器和查看器
- 丰富的控制选项
- 满足专业需求的高级功能

---

## 7. 产品边界

### 7.1 查看器负责

**核心职责**：
- 卡片和箱子的查看和浏览
- 查看工具插件的管理和调度
- 主题的应用和切换
- 导航和搜索
- 元数据显示
- 用户界面和交互

**技术职责**：
- 通过路由调用基础层查看工具
- 管理插件生命周期
- 处理用户交互事件
- 渲染界面组件
- 缓存管理

### 7.2 查看器不负责

**功能限制**：
- ❌ 不提供卡片内容编辑功能（需要编辑引擎）
- ❌ 不提供卡片创建功能（需要编辑引擎）
- ❌ 不提供文件管理功能（需要资源管理器）
- ❌ 不提供云同步功能（由独立服务提供）
- ❌ 不提供社区功能（由社区服务器提供）

**技术限制**：
- ❌ 不自己实现查看工具（调用基础层）
- ❌ 不直接调用其他模块（通过路由）
- ❌ 不包含业务逻辑（前后端分离）
- ❌ 不硬编码样式（使用主题系统）

### 7.3 边界说明

**与编辑引擎的边界**：
- 查看器专注于查看和浏览
- 编辑引擎提供完整的创作能力
- 两者可以共存，也可以合并
- 共享插件生态和基础设施

**与公共基础层的边界**：
- 基础层提供查看工具组件
- 查看器调用这些组件，不重新实现
- 查看器负责组件的组织和调度
- 查看器处理用户交互和界面

**与插件的边界**：
- 插件提供专业的查看工具实现
- 查看器提供插件的运行环境
- 查看器负责插件的加载和管理
- 查看器不干预插件内部实现

---

## 8. 成功指标

### 8.1 性能指标

| 指标 | 目标值 | 说明 |
|------|--------|------|
| 冷启动时间 | < 2 秒 | 首次启动应用 |
| 热启动时间 | < 1 秒 | 再次启动应用 |
| 文件打开时间 | < 500ms | 打开卡片文件 |
| 页面切换时间 | < 200ms | 切换不同卡片 |
| 空闲内存占用 | < 200MB | 应用启动后空闲状态 |
| 查看卡片内存 | < 500MB | 查看普通卡片 |
| 界面交互响应 | < 16ms | 保持 60fps |

### 8.2 用户指标

| 指标 | 目标值 |
|------|--------|
| 用户满意度 | > 4.5/5 |
| 日活用户增长率 | > 10%/月 |
| 7日用户留存率 | > 60% |
| 崩溃率 | < 0.1% |
| 用户反馈响应时间 | < 24 小时 |

### 8.3 生态指标

| 指标 | 目标值 |
|------|--------|
| 第三方查看工具插件数量 | > 50 |
| 被其他应用集成次数 | > 100 |
| 卡片文件打开次数 | > 10 万/日 |
| 插件下载次数 | > 1 万/月 |

---

## 9. 产品路线图

### 9.1 第一阶段（MVP）- v1.0.0

**目标**：提供基础的卡片查看能力

**功能**：
- 基础卡片渲染（文本、图片、视频、音频）
- 核心查看工具（基于基础层提供的组件）
- 简单主题支持
- 桌面端支持（Windows、macOS、Linux）
- 基础插件系统

**技术**：
- 完成与微内核的集成
- 完成与公共基础层的对接
- 实现基础的路由调用
- 实现插件加载和管理

### 9.2 第二阶段 - v1.5.0

**目标**：完善插件生态和查看能力

**功能**：
- 完整的插件系统
- 更多查看工具插件（PDF、代码、3D 等）
- 箱子布局展示
- 高级主题和动画
- 移动端支持（iOS、Android）

**技术**：
- 插件沙箱机制
- 性能优化
- 跨平台适配

### 9.3 第三阶段 - v2.0.0

**目标**：生态建设和功能增强

**功能**：
- Web 端支持（浏览器直接使用）
- 第三方插件生态建设
- 高级查看功能（AR/VR、AI 内容摘要）
- 协同批注（只读）

**技术**：
- WebAssembly 支持
- 云端集成
- AI 功能集成

### 9.4 第四阶段 - v3.0.0

**目标**：企业级功能和更多创新

**功能**：
- 企业级权限管理
- 审计日志
- 批量处理
- 更多平台适配

---

## 10. 总结

Chips Viewer 是 Chips 生态中不可或缺的一部分，它：

1. **基于坚实的基础设施**：
   - 共享薯片内核的路由系统
   - 调用公共基础层的查看工具
   - 使用统一的组件库和主题系统

2. **遵循核心架构原则**：
   - 严格遵循中心路由原则，所有通信通过内核
   - 采用极致模块化设计，模块完全解耦
   - 前后端完全分离，职责清晰

3. **提供出色的用户体验**：
   - 轻量快速，专注查看
   - 插件化设计，可扩展性强
   - 跨平台支持，适用范围广

4. **促进生态繁荣**：
   - 降低内容消费门槛
   - 开放的插件生态
   - 与其他产品无缝协作

通过插件化的查看工具系统、基于公共基础层的设计、以及微内核路由架构，Chips Viewer 为用户提供了专业、高效、可扩展的卡片查看体验，同时也为 Chips 生态的发展奠定了坚实的基础。

---

**文档维护者**：Chips 生态团队  
**审核状态**：✅ 已审核  
**下一步**：阅读[功能需求文档](./02-功能需求.md)了解详细功能
