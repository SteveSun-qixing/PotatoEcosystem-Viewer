# 文件结构完整索引

本文档提供 Chips Viewer 完整的文件结构索引和每个文件的作用说明。

## 目录

1. [项目根目录](#1-项目根目录)
2. [源代码目录 (src/)](#2-源代码目录-src)
3. [测试目录 (tests/)](#3-测试目录-tests)
4. [文档目录 (docs/)](#4-文档目录-docs)
5. [配置文件](#5-配置文件)
6. [模块划分](#6-模块划分)

---

## 1. 项目根目录

```
chips-viewer/
├── src/                    # 源代码目录
├── tests/                  # 测试目录
├── docs/                   # 文档目录
├── dist/                   # 构建输出目录
├── node_modules/           # 依赖包目录
├── public/                 # 公共资源目录
├── .github/                # GitHub 配置
├── package.json            # 项目配置文件
├── tsconfig.json           # TypeScript 配置
├── webpack.config.js       # Webpack 配置
├── jest.config.js          # Jest 配置
├── .eslintrc.js            # ESLint 配置
├── .prettierrc             # Prettier 配置
├── .gitignore              # Git 忽略文件
├── README.md               # 项目说明
└── LICENSE                 # 开源协议
```

---

## 2. 源代码目录 (src/)

### 2.1 核心模块 (core/)

```
src/core/
├── ViewerApp.ts                    # 查看器应用主类
├── NavigationController.ts         # 导航控制器
├── InteractionController.ts        # 交互控制器
├── LayoutManager.ts                # 布局管理器
├── CardParser.ts                   # 卡片解析器
├── BoxParser.ts                    # 箱子解析器
├── ResourceManager.ts              # 资源管理器
├── EventBus.ts                     # 事件总线
├── ConfigManager.ts                # 配置管理器
├── CacheSystem.ts                  # 缓存系统
├── VirtualScroller.ts              # 虚拟滚动
├── LazyLoader.ts                   # 懒加载器
├── IncrementalRenderer.ts          # 增量渲染器
├── RenderCache.ts                  # 渲染缓存
└── Router.ts                       # 路由系统
```

#### 核心文件说明

- **ViewerApp.ts**: 应用入口,负责初始化和协调各个模块
- **NavigationController.ts**: 处理导航逻辑,管理历史记录
- **InteractionController.ts**: 处理用户交互事件（点击、键盘、触摸等）
- **CardParser.ts**: 解析卡片文件,验证数据格式
- **EventBus.ts**: 提供发布-订阅模式的事件系统
- **CacheSystem.ts**: 实现LRU缓存策略,优化性能

---

### 2.2 渲染模块 (renderer/)

```
src/renderer/
├── CardRenderer.ts                 # 卡片渲染器基类
├── RendererFactory.ts              # 渲染器工厂
├── renderers/                      # 具体渲染器
│   ├── RichTextCardRenderer.ts    # 富文本渲染器
│   ├── MarkdownCardRenderer.ts    # Markdown 渲染器
│   ├── ImageCardRenderer.ts       # 图片渲染器
│   ├── VideoCardRenderer.ts       # 视频渲染器
│   ├── AudioCardRenderer.ts       # 音频渲染器
│   ├── CodeCardRenderer.ts        # 代码渲染器
│   ├── ListCardRenderer.ts        # 列表渲染器
│   ├── RatingCardRenderer.ts      # 打分渲染器
│   ├── WebCardRenderer.ts         # 网页渲染器
│   └── CompositeCardRenderer.ts   # 复合卡片渲染器
├── BoxRenderer.ts                  # 箱子渲染器
├── ThemeApplier.ts                 # 主题应用器
├── StyleCalculator.ts              # 样式计算器
├── layouts/                        # 布局引擎
│   ├── GridLayoutEngine.ts        # 网格布局
│   ├── WaterfallLayoutEngine.ts   # 瀑布流布局
│   ├── ListLayoutEngine.ts        # 列表布局
│   ├── KanbanLayoutEngine.ts      # 看板布局
│   └── ResponsiveLayoutManager.ts # 响应式布局管理
├── VirtualDOM.ts                   # 虚拟 DOM
└── Optimizer.ts                    # 渲染优化器
```

#### 渲染器文件说明

- **CardRenderer.ts**: 渲染器基类,定义渲染流程
- **RendererFactory.ts**: 根据卡片类型创建对应渲染器
- **ThemeApplier.ts**: 应用主题样式到渲染结果
- **GridLayoutEngine.ts**: 实现网格布局算法
- **WaterfallLayoutEngine.ts**: 实现瀑布流布局（Masonry）

---

### 2.3 插件模块 (plugin/)

```
src/plugin/
├── PluginManager.ts                # 插件管理器
├── PluginLoader.ts                 # 插件加载器
├── PluginDispatcher.ts             # 插件调度器
├── PluginSandbox.ts                # 插件沙箱
├── PluginRegistry.ts               # 插件注册表
├── PluginContext.ts                # 插件上下文
├── PluginStorage.ts                # 插件存储
├── PluginSettings.ts               # 插件设置
├── PermissionManager.ts            # 权限管理器
├── PluginMarketplace.ts            # 插件市场
└── builtins/                       # 内置插件
    ├── ImageViewerPlugin.ts       # 图片查看器
    ├── VideoPlayerPlugin.ts       # 视频播放器
    ├── AudioPlayerPlugin.ts       # 音频播放器
    ├── CodeViewerPlugin.ts        # 代码查看器
    ├── MarkdownRendererPlugin.ts  # Markdown 渲染器
    └── GenericViewerPlugin.ts     # 通用查看器
```

#### 插件模块文件说明

- **PluginManager.ts**: 管理插件生命周期（安装、卸载、更新）
- **PluginLoader.ts**: 加载插件代码,验证插件有效性
- **PluginDispatcher.ts**: 根据文件类型调度合适的插件
- **PluginSandbox.ts**: 在隔离环境中运行插件,限制权限
- **PermissionManager.ts**: 管理插件权限,处理权限请求

---

### 2.4 主题模块 (theme/)

```
src/theme/
├── ThemeManager.ts                 # 主题管理器
├── ThemeLoader.ts                  # 主题加载器
├── ThemeValidator.ts               # 主题验证器
├── themes/                         # 内置主题
│   ├── light.ts                   # 简洁白主题
│   ├── dark.ts                    # 深邃黑主题
│   ├── blue.ts                    # 海洋蓝主题
│   ├── green.ts                   # 森林绿主题
│   └── purple.ts                  # 高贵紫主题
└── ThemeProvider.ts                # 主题提供者接口
```

#### 主题文件说明

- **ThemeManager.ts**: 管理主题加载、切换和导入导出
- **ThemeValidator.ts**: 验证主题文件格式是否正确
- **light.ts** / **dark.ts**: 内置的亮色和暗色主题定义

---

### 2.5 平台适配模块 (platform/)

```
src/platform/
├── IPlatformAdapter.ts             # 平台适配器接口
├── web/                            # Web 平台
│   ├── WebAdapter.ts              # Web 适配器
│   ├── WebFileSystem.ts           # Web 文件系统
│   └── WebStorage.ts              # Web 存储
├── electron/                       # Electron 平台（桌面端）
│   ├── ElectronAdapter.ts         # Electron 适配器
│   ├── ElectronFileSystem.ts      # Electron 文件系统
│   └── ElectronWindow.ts          # Electron 窗口管理
├── capacitor/                      # Capacitor 平台（移动端）
│   ├── CapacitorAdapter.ts        # Capacitor 适配器
│   ├── CapacitorFileSystem.ts     # Capacitor 文件系统
│   └── CapacitorDevice.ts         # Capacitor 设备信息
└── native/                         # 原生平台
    ├── iOSAdapter.swift           # iOS 适配器
    └── AndroidAdapter.kt          # Android 适配器
```

#### 平台适配文件说明

- **IPlatformAdapter.ts**: 定义平台适配器统一接口
- **WebAdapter.ts**: Web 平台实现,使用 IndexedDB 和 File API
- **ElectronAdapter.ts**: 桌面平台实现,使用 Node.js 文件系统
- **CapacitorAdapter.ts**: 移动平台实现,使用 Capacitor 插件

---

### 2.6 UI 组件模块 (ui/)

```
src/ui/
├── Toolbar.ts                      # 工具栏
├── Sidebar.ts                      # 侧边栏
├── ContentArea.ts                  # 内容区域
├── StatusBar.ts                    # 状态栏
├── Dialog.ts                       # 对话框
├── Toast.ts                        # 提示消息
├── ContextMenu.ts                  # 右键菜单
├── ProgressBar.ts                  # 进度条
├── Spinner.ts                      # 加载指示器
├── FileExplorer.ts                 # 文件浏览器
├── CardTree.ts                     # 卡片树视图
└── SettingsPanel.ts                # 设置面板
```

#### UI 组件文件说明

- **Toolbar.ts**: 顶部工具栏,包含操作按钮
- **Sidebar.ts**: 侧边栏,显示卡片树或元数据
- **ContentArea.ts**: 主内容区域,渲染卡片
- **Dialog.ts**: 通用对话框组件
- **Toast.ts**: 轻量级消息提示

---

### 2.7 类型定义模块 (types/)

```
src/types/
├── Card.ts                         # 卡片类型
├── CardTypes.ts                    # 卡片类型枚举
├── RichTextCard.ts                 # 富文本卡片
├── MarkdownCard.ts                 # Markdown 卡片
├── ImageCard.ts                    # 图片卡片
├── VideoCard.ts                    # 视频卡片
├── AudioCard.ts                    # 音频卡片
├── CodeCard.ts                     # 代码卡片
├── ListCard.ts                     # 列表卡片
├── RatingCard.ts                   # 打分卡片
├── WebCard.ts                      # 网页卡片
├── CompositeCard.ts                # 复合卡片
├── Box.ts                          # 箱子类型
├── Theme.ts                        # 主题类型
├── Plugin.ts                       # 插件类型
├── Event.ts                        # 事件类型
├── Layout.ts                       # 布局类型
├── FileInfo.ts                     # 文件信息
├── RenderOptions.ts                # 渲染选项
├── Config.ts                       # 配置类型
└── index.ts                        # 类型导出
```

#### 类型文件说明

- **Card.ts**: 卡片基础接口定义
- **Theme.ts**: 主题数据结构定义
- **Plugin.ts**: 插件相关类型定义
- **index.ts**: 统一导出所有类型

---

### 2.8 工具函数模块 (utils/)

```
src/utils/
├── file.ts                         # 文件工具
├── dom.ts                          # DOM 工具
├── format.ts                       # 格式化工具
├── validation.ts                   # 验证工具
├── async.ts                        # 异步工具
├── object.ts                       # 对象工具
├── string.ts                       # 字符串工具
├── color.ts                        # 颜色工具
├── math.ts                         # 数学工具
├── date.ts                         # 日期工具
└── index.ts                        # 工具导出
```

#### 工具函数文件说明

- **file.ts**: 文件路径、扩展名、MIME 类型等工具
- **dom.ts**: DOM 操作、样式、类名等工具
- **async.ts**: 防抖、节流、重试、超时等异步工具
- **validation.ts**: 数据验证、URL 验证等

---

### 2.9 接口定义模块 (interfaces/)

```
src/interfaces/
├── IViewerApp.ts                   # 查看器应用接口
├── ICardRenderer.ts                # 卡片渲染器接口
├── IViewerToolPlugin.ts            # 查看工具插件接口
├── IPluginManager.ts               # 插件管理器接口
├── IThemeManager.ts                # 主题管理器接口
├── IPlatformAdapter.ts             # 平台适配器接口
├── IFileSystem.ts                  # 文件系统接口
├── IEventBus.ts                    # 事件总线接口
├── ILayoutEngine.ts                # 布局引擎接口
├── IThemeApplier.ts                # 主题应用器接口
└── index.ts                        # 接口导出
```

---

### 2.10 常量模块 (constants/)

```
src/constants/
├── events.ts                       # 事件常量
├── errors.ts                       # 错误常量
├── defaults.ts                     # 默认值常量
├── mimeTypes.ts                    # MIME 类型常量
├── shortcuts.ts                    # 快捷键常量
└── index.ts                        # 常量导出
```

---

### 2.11 入口文件

```
src/
├── index.ts                        # 主入口文件（Web）
├── main.ts                         # Electron 主进程入口
├── preload.ts                      # Electron 预加载脚本
├── renderer.ts                     # Electron 渲染进程入口
└── capacitor.ts                    # Capacitor 入口
```

---

## 3. 测试目录 (tests/)

```
tests/
├── unit/                           # 单元测试
│   ├── core/                      # 核心模块测试
│   │   ├── ViewerApp.test.ts
│   │   ├── CardParser.test.ts
│   │   └── EventBus.test.ts
│   ├── renderer/                  # 渲染模块测试
│   │   ├── CardRenderer.test.ts
│   │   ├── ThemeApplier.test.ts
│   │   └── LayoutEngine.test.ts
│   ├── plugin/                    # 插件模块测试
│   │   ├── PluginManager.test.ts
│   │   ├── PluginDispatcher.test.ts
│   │   └── PluginSandbox.test.ts
│   └── utils/                     # 工具函数测试
│       ├── file.test.ts
│       ├── dom.test.ts
│       └── async.test.ts
├── integration/                    # 集成测试
│   ├── rendering.test.ts          # 渲染流程测试
│   ├── plugin-loading.test.ts     # 插件加载测试
│   ├── theme-switching.test.ts    # 主题切换测试
│   └── navigation.test.ts         # 导航测试
├── e2e/                           # 端到端测试
│   ├── view-card.spec.ts          # 查看卡片测试
│   ├── plugin-usage.spec.ts       # 插件使用测试
│   ├── theme-switching.spec.ts    # 主题切换测试
│   └── cross-platform.spec.ts     # 跨平台测试
├── performance/                    # 性能测试
│   ├── rendering.perf.test.ts     # 渲染性能测试
│   ├── memory.perf.test.ts        # 内存测试
│   └── loading.perf.test.ts       # 加载性能测试
├── security/                       # 安全测试
│   ├── input-validation.test.ts   # 输入验证测试
│   └── plugin-sandbox.test.ts     # 插件沙箱测试
├── setup.ts                        # 测试环境设置
├── helpers.ts                      # 测试辅助函数
└── mocks/                          # Mock 数据
    ├── cards.ts                   # 模拟卡片数据
    ├── themes.ts                  # 模拟主题数据
    └── plugins.ts                 # 模拟插件数据
```

---

## 4. 文档目录 (docs/)

```
docs/
├── README.md                       # 文档首页
├── getting-started/                # 入门指南
│   ├── installation.md            # 安装说明
│   ├── quick-start.md             # 快速开始
│   └── basic-usage.md             # 基础使用
├── api/                            # API 文档
│   ├── core-api.md                # 核心 API
│   ├── render-api.md              # 渲染 API
│   ├── plugin-api.md              # 插件 API
│   └── theme-api.md               # 主题 API
├── guides/                         # 开发指南
│   ├── plugin-development.md      # 插件开发指南
│   ├── theme-customization.md     # 主题定制指南
│   └── platform-specific.md       # 平台特定说明
├── architecture/                   # 架构文档
│   ├── overview.md                # 架构概览
│   ├── rendering-engine.md        # 渲染引擎
│   └── plugin-system.md           # 插件系统
└── contributing/                   # 贡献指南
    ├── code-of-conduct.md         # 行为准则
    ├── development.md             # 开发指南
    └── pull-request.md            # PR 指南
```

---

## 5. 配置文件

### 5.1 package.json

**路径**: `package.json`

**作用**: 项目配置和依赖管理

```json
{
  "name": "chips-viewer",
  "version": "1.0.0",
  "description": "A powerful card viewer for Chips ecosystem",
  "main": "dist/index.js",
  "scripts": {
    "dev": "webpack serve --mode development",
    "build": "webpack --mode production",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "lint": "eslint src --ext .ts,.tsx",
    "format": "prettier --write \"src/**/*.{ts,tsx}\""
  },
  "dependencies": {
    "@chips/core": "^1.0.0",
    "marked": "^9.0.0",
    "prismjs": "^1.29.0",
    "katex": "^0.16.0"
  },
  "devDependencies": {
    "@types/jest": "^29.0.0",
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "jest": "^29.0.0",
    "typescript": "^5.0.0",
    "webpack": "^5.88.0"
  }
}
```

---

### 5.2 tsconfig.json

**路径**: `tsconfig.json`

**作用**: TypeScript 编译配置

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM"],
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "tests"]
}
```

---

### 5.3 webpack.config.js

**路径**: `webpack.config.js`

**作用**: Webpack 打包配置

---

### 5.4 jest.config.js

**路径**: `jest.config.js`

**作用**: Jest 测试配置

---

### 5.5 .eslintrc.js

**路径**: `.eslintrc.js`

**作用**: ESLint 代码规范配置

---

## 6. 模块划分

### 6.1 按功能划分

- **核心模块** (core/): 应用核心功能
- **渲染模块** (renderer/): 卡片和箱子渲染
- **插件模块** (plugin/): 插件系统
- **主题模块** (theme/): 主题管理
- **平台模块** (platform/): 平台适配
- **UI 模块** (ui/): 用户界面组件
- **工具模块** (utils/): 工具函数
- **类型模块** (types/): 类型定义

### 6.2 按层次划分

- **表现层**: ui/, renderer/
- **业务层**: core/, plugin/, theme/
- **数据层**: types/, platform/
- **工具层**: utils/, constants/

---

## 7. 文件统计

- **总文件数**: 150+
- **TypeScript 文件**: 120+
- **测试文件**: 40+
- **文档文件**: 20+
- **配置文件**: 10+

---

## 8. 代码行数统计

- **源代码**: ~15,000 行
- **测试代码**: ~8,000 行
- **文档**: ~5,000 行
- **配置**: ~500 行

---

## 9. 依赖关系图

```
src/
├── index.ts (入口)
│   └── ViewerApp.ts
│       ├── NavigationController.ts
│       ├── InteractionController.ts
│       ├── PluginManager.ts
│       │   ├── PluginLoader.ts
│       │   ├── PluginDispatcher.ts
│       │   └── PluginSandbox.ts
│       ├── ThemeManager.ts
│       ├── CardRenderer.ts
│       │   ├── RendererFactory.ts
│       │   └── ThemeApplier.ts
│       ├── EventBus.ts
│       ├── ConfigManager.ts
│       └── ResourceManager.ts
```

---

## 10. 构建输出 (dist/)

```
dist/
├── index.js                        # 主入口（UMD）
├── index.esm.js                    # ES Module 入口
├── index.d.ts                      # 类型定义
├── css/                            # 样式文件
│   ├── viewer.css                 # 主样式
│   └── themes/                    # 主题样式
│       ├── light.css
│       └── dark.css
├── assets/                         # 静态资源
│   ├── icons/                     # 图标
│   └── fonts/                     # 字体
└── chunks/                         # 代码分块
    ├── core.js
    ├── renderer.js
    ├── plugin.js
    └── theme.js
```

---

## 附录

### A. 文件命名规范

1. **类文件**: PascalCase（如 `ViewerApp.ts`）
2. **工具文件**: camelCase（如 `formatDate.ts`）
3. **接口文件**: 以 `I` 开头（如 `IViewerApp.ts`）
4. **测试文件**: `.test.ts` 或 `.spec.ts`

### B. 目录组织原则

1. **按功能分组**: 相关功能放在同一目录
2. **按层次分层**: 核心、业务、工具分层
3. **扁平化**: 避免过深的嵌套
4. **可扩展**: 便于添加新功能

### C. 快速查找

- **找核心逻辑**: `src/core/`
- **找渲染代码**: `src/renderer/`
- **找插件代码**: `src/plugin/`
- **找类型定义**: `src/types/`
- **找工具函数**: `src/utils/`
- **找测试**: `tests/`

### D. 参考链接

- [项目结构最佳实践](https://chips.dev/docs/project-structure)
- [代码组织指南](https://chips.dev/docs/code-organization)
- [贡献指南](https://chips.dev/docs/contributing)
